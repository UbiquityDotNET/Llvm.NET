<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>LLVM-C Handle wrappers | Llvm.NET </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="LLVM-C Handle wrappers | Llvm.NET ">
    <meta name="generator" content="docfx 2.48.1.0">
    
    <link rel="shortcut icon" href="../../favicon.ico">
    <link rel="stylesheet" href="../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../styles/docfx.css">
    <link rel="stylesheet" href="../../styles/main.css">
    <meta property="docfx:navrel" content="../../toc">
    <meta property="docfx:tocrel" content="toc">
    
    
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../../index.html">
                <img id="logo" class="svg" src="../../DragonSharp48x48.png" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
                
                <ul class="nav level1 navbar-nav">
                      <li>
                          <a href="../../api/index.html" title="API Documentation">API Documentation</a>
                      </li>
                      <li>
                          <a href="../../articles/index.html" title="Articles">Articles</a>
                      </li>
                      <li>
                          <a href="https://github.com/UbiquityDotNET/Llvm.NET" title="GitHub Repository">GitHub Repository</a>
                      </li>
                      <li>
                          <a href="http://LLVM.org" title="LLVM.org">LLVM.org</a>
                      </li>
                      <li>
                          <a href="http://releases.llvm.org/8.0.0/docs/index.html" title="LLVM Docs">LLVM Docs</a>
                      </li>
                </ul>    </div>
          </div>
        </nav>
      </header>
      <div role="main" class="container body-content hide-when-search">
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div>
              <div class="sidefilter">
                <form class="toc-filter">
                  <span class="glyphicon glyphicon-filter filter-icon"></span>
                  <input type="text" id="toc_filter_input" placeholder="Enter here to filter..." onkeypress="if(event.keyCode==13) {return false;}">
                </form>
              </div>
              <div class="sidetoc">
                <div class="toc" id="toc">
                  
                  <ul class="nav level1">
                    <li class="">
                      <span class="expand-stub"></span>
                      <a class="">LLVM-C API Handles</a>
                        
                        <ul class="nav level2">
                          <li class="active">
                            <a href="llvm-handles.html" title="Wrapping LLVM-C Handles" class="active">Wrapping LLVM-C Handles</a>
                          </li>
                          <li class="">
                            <a href="handleref-interning.html" title="Interning LLVM-C Handles" class="">Interning LLVM-C Handles</a>
                          </li>
                        </ul>  </li>
                    <li class="">
                      <span class="expand-stub"></span>
                      <a class="">Marshaling LLVM types</a>
                        
                        <ul class="nav level2">
                          <li class="">
                            <a href="marshal-string.html" title="Marshaling Strings" class="">Marshaling Strings</a>
                          </li>
                          <li class="">
                            <a href="marshal-LLVMBool.html" title="Marshaling LLVMBool" class="">Marshaling LLVMBool</a>
                          </li>
                        </ul>  </li>
                    <li class="">
                      <span class="expand-stub"></span>
                      <a class="">LLVMBindingsGenerator</a>
                        
                        <ul class="nav level2">
                          <li class="">
                            <a href="LlvmBindingsGenerator-Overview.html" title="Bindings Overview" class="">Bindings Overview</a>
                          </li>
                          <li class="">
                            <span class="expand-stub"></span>
                            <a href="LlvmBindingsGenerator-Configuration.html" title="Configuration" class="">Configuration</a>
                              
                              <ul class="nav level3">
                                <li class="">
                                  <a href="LlvmBindingsGenerator-MarshalingInfo-Table.html" title="Marshaling Info Table" class="">Marshaling Info Table</a>
                                </li>
                              </ul>  </li>
                        </ul>  </li>
                  </ul>        </div>
              </div>
            </div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h2 id="llvm-c-handle-wrappers">LLVM-C Handle wrappers</h2>

<p>Handles for LLVM are just opaque pointers. They generally come in one of three forms.</p>
<ol>
<li>Context owned<br>Where there is always a well known owner that ultimately is responsible for
disposing/releasing the resource.</li>
<li>Global resources<br>Where there is no parent child ownership relationship and callers must manually release the resource</li>
<li>An unowned alias to a global resource<br>This occurs when a child of a global resource contains a reference to the parent. In such
a case the handle should be considered like an alias and not disposed.</li>
</ol>
<p>The Handle implementations in Llvm.NET follow consistent patterns for implementing each form of handle.</p>
<h3 id="contextual-handles">Contextual handles</h3>
<p>These handles are never manually released or disposed, though releasing their containers will make them
invalid. The general pattern for implementing such handles is as follows:</p>
<pre><code class="lang-C#">using System;
using System.Collections.Generic;

namespace Llvm.NET.Native
{
    internal struct LLVMxyzRef
        : IEquatable&lt;LLVMxyzRef&gt;
    {
        public override int GetHashCode( ) =&gt; Handle.GetHashCode( );

        public override bool Equals( object obj )
            =&gt; !( obj is null )
             &amp;&amp; ( obj is LLVMxyxRef r )
             &amp;&amp; ( r.Handle == Handle );

        public bool Equals( LLVMxyxRef other )
            =&gt; Handle == other.Handle;

        public static bool operator ==( LLVMxyxRef lhs, LLVMxyxRef rhs )
            =&gt; EqualityComparer&lt;LLVMxyxRef&gt;.Default.Equals( lhs, rhs );

        public static bool operator !=( LLVMxyxRef lhs, LLVMxyxRef rhs )
            =&gt; !( lhs == rhs );

        internal LLVMxyxRef( IntPtr pointer )
        {
            Handle = pointer;
        }

        private readonly IntPtr Handle;
    }
}
</code></pre><h3 id="global-handles">Global Handles</h3>
<p>Global handles require the caller to explicitly release the resources. In Llvm.NET these
are managed with the .NET SafeHandles types through an Llvm.NET specific derived type
LlvmObject. Since these types are derived from a SafeHandle they are properly cleaned
up by the runtime without the need to make the containing type implement IDisposable,
though there may be other reasons to make a type Disposable. Generally, types should
avoid IDisposable unless they really need to perform some special cleanup early or in
a particular ordered sequence but such cases are rare.</p>
<p>All resource handles in Llvm.NET requiring explicit release are handled consistently
using the following basic pattern:</p>
<pre><code class="lang-C#">using System;
using System.Runtime.InteropServices;
using System.Security;

using static Llvm.NET.Native.NativeMethods;

namespace Llvm.NET.Native
{
    [SecurityCritical]
    internal class LLVMxyzRef
        : LlvmObjectRef
    {
        public LLVMxyzRef( IntPtr handle, bool owner )
            : base( owner )
        {
            SetHandle( handle );
        }

        [SecurityCritical]
        protected override bool ReleaseHandle( )
        {
            LLVMDisposeXyz( handle );
            return true;
        }

        private LLVMxyzRef( )
            : base( true )
        {
        }

        [DllImport( LibraryPath, CallingConvention = CallingConvention.Cdecl )]
        private static extern void LLVMDisposeXyz( IntPtr @xyz );
    }
}
</code></pre><h3 id="global-alias-handles">Global Alias handles</h3>
<p>Global alias handles are a specialized form of global handles where they do not
participate in ownership control/release. These are commonly used when a child
of a global container exposes a property that references the parent container.
In such cases the reference retrieved from the child shouldn&#39;t be used to destroy
the parent when no longer used. </p>
<p>In Llvm.NET this is represented as a distinct handle type derived from the global
handle as follows:</p>
<pre><code class="lang-C#">// xyz alias
internal class LLVMxyzAlias
    : LLVMxyzRef
{
    private LLVMxyzAlias()
        : base( IntPtr.Zero, false )
    {
    }
}
</code></pre></article>
          </div>
          <div class="contribution-panel mobile-hide">
              <a href="https://github.com/UbiquityDotNET/Llvm.NET/blob/master/docfx/articles/InternalDetails/llvm-handles.md/#L1" title="Improve this Doc" class="fab btn-warning pull-right"><i class="glyphicon glyphicon-pencil"></i></a>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            Copyright (C) 2017-2019, Ubiquity.NET Contributors<br><strong>Build:</strong> 8.0.0-beta
            
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../styles/main.js"></script>
  </body>
</html>
