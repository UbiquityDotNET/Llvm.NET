<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>1. Kaleidoscope: Language Introduction | Ubiquity.NET.Llvm </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="1. Kaleidoscope: Language Introduction | Ubiquity.NET.Llvm ">
    <meta name="generator" content="docfx 2.58.5.0">
    
    <link rel="shortcut icon" href="../../../favicon.ico">
    <link rel="stylesheet" href="../../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../../styles/docfx.css">
    <link rel="stylesheet" href="../../../styles/main.css">
    <meta property="docfx:navrel" content="../../../toc">
    <meta property="docfx:tocrel" content="../toc">
    
    
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../../../index.html">
                <img id="logo" class="svg" src="../../../DragonSharp48x48.png" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
                
                <ul class="nav level1 navbar-nav">
                      <li>
                          <a href="../../../api/index.html" title="API Documentation">API Documentation</a>
                      </li>
                      <li>
                          <a href="https://github.com/UbiquityDotNET/Llvm.NET" title="Source Repository">Source Repository</a>
                      </li>
                      <li>
                          <a href="http://LLVM.org" title="LLVM.org">LLVM.org</a>
                      </li>
                      <li>
                          <a href="http://releases.llvm.org/10.0.0/docs/index.html" title="LLVM Docs">LLVM Docs</a>
                      </li>
                </ul>    </div>
          </div>
        </nav>
      </header>
      <div role="main" class="container body-content hide-when-search">
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div>
              <div class="sidefilter">
                <form class="toc-filter">
                  <span class="glyphicon glyphicon-filter filter-icon"></span>
                  <input type="text" id="toc_filter_input" placeholder="Enter here to filter..." onkeypress="if(event.keyCode==13) {return false;}">
                </form>
              </div>
              <div class="sidetoc">
                <div class="toc" id="toc">
                  
                  <ul class="nav level1">
                    <li class="">
                      <span class="expand-stub"></span>
                      <a class="">Samples</a>
                        
                        <ul class="nav level2">
                          <li class="">
                            <a class="">Code Generation</a>
                          </li>
                          <li class="">
                            <a href="../CodeGenWithDebugInfo/codegeneration.html" title="CodeGenerator With Debug Information" class="">CodeGenerator With Debug Information</a>
                          </li>
                        </ul>  </li>
                    <li class="">
                      <span class="expand-stub"></span>
                      <a class="">Kaleidoscope</a>
                        
                        <ul class="nav level2">
                          <li class="">
                            <a href="../Kaleidoscope/Kaleidoscope-Overview.html" title="Chapter 1 - Language Introduction" class="">Chapter 1 - Language Introduction</a>
                          </li>
                          <li class="">
                            <a href="../Kaleidoscope/Chapter2/Kaleidoscope-ch2.html" title="Chapter 2 - Implementing the parser" class="">Chapter 2 - Implementing the parser</a>
                          </li>
                          <li class="">
                            <a href="../Kaleidoscope/Chapter3/Kaleidoscope-ch3.html" title="Chapter 3 - Generating LLVM IR" class="">Chapter 3 - Generating LLVM IR</a>
                          </li>
                          <li class="">
                            <a href="../Kaleidoscope/Chapter4/Kaleidoscope-ch4.html" title="Chapter 4 - JIT and Optimizer Support" class="">Chapter 4 - JIT and Optimizer Support</a>
                          </li>
                          <li class="">
                            <a href="../Kaleidoscope/Chapter5/Kaleidoscope-ch5.html" title="Chapter 5 - Control Flow" class="">Chapter 5 - Control Flow</a>
                          </li>
                          <li class="">
                            <a href="../Kaleidoscope/Chapter6/Kaleidoscope-ch6.html" title="Chapter 6 - User Defined Operators" class="">Chapter 6 - User Defined Operators</a>
                          </li>
                          <li class="">
                            <a href="../Kaleidoscope/Chapter7/Kaleidoscope-ch7.html" title="Chapter 7 - Mutable Variables" class="">Chapter 7 - Mutable Variables</a>
                          </li>
                          <li class="">
                            <a href="../Kaleidoscope/Chapter7.1/Kaleidoscope-ch7.1.html" title="Chapter 7.1 - Extreme Lazy JIT" class="">Chapter 7.1 - Extreme Lazy JIT</a>
                          </li>
                          <li class="">
                            <a href="../Kaleidoscope/Chapter8/Kaleidoscope-ch8.html" title="Chapter 8 - AOT Compilation" class="">Chapter 8 - AOT Compilation</a>
                          </li>
                          <li class="">
                            <a href="../Kaleidoscope/Chapter9/Kaleidoscope-ch9.html" title="Chapter 9 - Debug Information" class="">Chapter 9 - Debug Information</a>
                          </li>
                          <li class="">
                            <span class="expand-stub"></span>
                            <a class="">Appendix</a>
                              
                              <ul class="nav level3">
                                <li class="">
                                  <a href="../Kaleidoscope/Kaleidoscope.Runtime/Kaleidoscope-Runtime.html" title="Kaleidoscope.Runtime" class="">Kaleidoscope.Runtime</a>
                                </li>
                                <li class="">
                                  <a href="../Kaleidoscope/Kaleidoscope.Parser/AST/Kaleidoscope-AST.html" title="Kaleidoscope AST" class="">Kaleidoscope AST</a>
                                </li>
                                <li class="">
                                  <a href="../Kaleidoscope/Kaleidoscope.Parser/ANTLR/Kaleidoscope-ParseTreeVisitor.html" title="ParseTree Visitor" class="">ParseTree Visitor</a>
                                </li>
                                <li class="">
                                  <a href="../Kaleidoscope/Kaleidoscope.Parser/ANTLR/Kaleidoscope-Parsetree-examples.html" title="ParseTree Examples" class="">ParseTree Examples</a>
                                </li>
                              </ul>  </li>
                        </ul>  </li>
                  </ul>        </div>
              </div>
            </div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="Kaleidoscope-Overview">
<h1 id="1-kaleidoscope-language-introduction">1. Kaleidoscope: Language Introduction</h1>

<p>The general flow of this tutorial follows that of the official
<a href="http://releases.llvm.org/6.0.1/docs/tutorial/LangImpl01.html">LLVM tutorial</a>
and many of the samples are lifted directly from that tutorial to make it easier to follow
along both tutorials to see how the various LLVM concepts are projected in the Ubiquity.NET.Llvm library.</p>
<h2 id="overview">Overview</h2>
<p>Kaleidoscope is a simple functional language that is used to illustrate numerous real world
use cases for Ubiquity.NET.Llvm for code generation and JIT execution.</p>
<p>It is worth pointing out that this example is not intended as a treatise on compiler design nor
on language parsing. While it contains many aspects of those topics the tutorial is, mostly, focused
on the use of Ubiquity.NET.Llvm for code generation. Furthermore it isn&#39;t a trans-literation of the LLVM C++
sample as that would defeat one of the major points of Ubiquity.NET.Llvm - to provide a familiar API and
use pattern to C# developers.</p>
<h2 id="general-layout">General layout</h2>
<p>The samples are built using common core libraries and patterns. They are explicitly designed to
make code comparisons between chapters via your favorite code comparison tool. Each, chapter builds
on the next so running a comparison makes it easy to see the changes in full context. The text of
the tutorials explains why the changes are made and a comparison helps provide the &quot;big picture&quot;
view.</p>
<h2 id="variations-from-the-official-llvm-tutorial">Variations from the Official LLVM Tutorial</h2>
<p>The Ubiquity.NET.Llvm version of the Kaleidoscope series takes a different route for parsing from the
LLVM implementation. In particular the Ubiquity.NET.Llvm version defines a formal grammar using
<a href="http://antlr.org">ANTLR4</a> with the full grammar for all variations of the language features in
a single assembly. Ultimately the parsing produces an <a class="xref" href="Kaleidoscope.Parser/AST/Kaleidoscope-AST.html">AST</a> so that the actual
technology used for the parse is hidden as an implementation detail. This helps in isolating the parsing
from the use of Ubiquity.NET.Llvm for code generation and JIT compilation for interactive languages.</p>
<h2 id="the-kaleidoscope-language">The Kaleidoscope Language</h2>
<h3 id="general-concepts">General Concepts</h3>
<p>Kaleidoscope is a simple functional language with the following major features:</p>
<ul>
<li>Only a single data type (equivalent to C double)</li>
<li>Built-in operators for basic expressions</li>
<li>If/then/else style control flow</li>
<li>For loop style control flow</li>
<li>User defined operators<ul>
<li>User defined operators can specify operator precedence<ul>
<li>User defined precedence is arguably the most complex part of parsing and implementing the language.
Though, ANTLR4&#39;s flexibility made it fairly easy to do once fully understood. (more details in
<a class="xref" href="Chapter6/Kaleidoscope-ch6.html">Chapter 6</a>)</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="expressions">Expressions</h3>
<p>In Kaleidoscope, everything is an expression (e.g. everything has or returns a value even if the value
is a constant 0.0). There are no statements and no &quot;void&quot; functions etc...</p>
<h4 id="multi-line-expressions">Multi-line expressions</h4>
<p>There are a few different ways to represent an expression that is long enough to warrant splitting it across
multiple lines when typing it out.</p>
<h5 id="expression-continuation-marker">Expression Continuation Marker</h5>
<p>One mechanism for handling multi-line expressions that is used in most shell scripting languages is a line
continuation marker. In such cases a special character followed by a line-termination char or char sequence
indicates that the expression continues on the next line (e.g. it isn&#39;t complete yet).</p>
<h5 id="expression-complete-marker">Expression Complete Marker</h5>
<p>Another approach to handling long expressions spanning multiple lines is basically the opposite of line
continuation, expression complete markers. This marker indicates the end of a potentially multi-line expression. (A variant
of this might require a line termination following the marker as with the line continuation).</p>
<h5 id="kaleidoscope-implementation">Kaleidoscope Implementation</h5>
<p>The original LLVM C++ implementation chose the expression completion approach using a semicolon as the completion.
(So it seems familiar like statements in other C like languages) Therefore, the Ubiquity.NET.Llvm tutorial follows the same
design. [Implementing the line continuation mechanism in Kaleidoscope is left as an exercise for the reader <span class="emoji" shortcode="wink">😉</span>]</p>
<h3 id="example">Example</h3>
<p>The following example is a complete program in Kaleidoscope that will generate a textual representation
of the classic Mandelbrot Set.</p>
<pre><code class="lang-Kaleidoscope" name="mandel.kls">def unary!(v)
  if v then
    0
  else
    1;

def unary-(v)
  0-v;

def binary&gt; 10 (LHS RHS)
  RHS &lt; LHS;

def binary| 5 (LHS RHS)
  if LHS then
    1
  else if RHS then
    1
  else
    0;

def binary&amp; 6 (LHS RHS)
  if !LHS then
    0
  else
    !!RHS;

def binary== 9 (LHS RHS)
  !(LHS &lt; RHS | LHS &gt; RHS);

def binary : 1 (x y) y;

extern putchard(char);

def printdensity(d)
  if d &gt; 8 then
    putchard(32)     # 32 =&gt; ASCII Space
  else if d &gt; 4 then
    putchard(46)     # 46 =&gt; ASCII &#39;.&#39;
  else if d &gt; 2 then
    putchard(43)     # 43 =&gt; ASCII &#39;+&#39;
  else
    putchard(42);    # 43 =&gt; ASCII &#39;*&#39;

def mandelconverger(real imag iters creal cimag)
  if iters &gt; 255 | (real*real + imag*imag &gt; 4) then
    iters
  else
    mandelconverger( real*real - imag*imag + creal
                   , 2*real*imag + cimag
                   , iters+1
                   , creal
                   , cimag
                   );

def mandelconverge(real imag)
  mandelconverger(real, imag, 0, real, imag);

def mandelhelp(xmin xmax xstep   ymin ymax ystep)
  for y = ymin, y &lt; ymax, ystep in
  (
    (for x = xmin, x &lt; xmax, xstep in printdensity(mandelconverge(x,y))) : putchard(10)
  );

def mandel(realstart imagstart realmag imagmag)
  mandelhelp(realstart, realstart+realmag*78, realmag, imagstart, imagstart+imagmag*40, imagmag);

mandel(-2.3, -1.3, 0.05, 0.07);
</code></pre><p>When entered ( or copy/pasted) to the command line Kaleidoscope will print out the following:</p>
<div class="NOTE"><h5>Note</h5><p>This example uses features of the language only enabled/discussed in Chapter 6 of the tutorial.
The runtime from chapters 3-5 will generate errors trying to parse this code.</p>
</div>
<pre><code class="lang-shell">Ready&gt;mandel(-2.3, -1.3, 0.05, 0.07);
*******************************************************************************
*******************************************************************************
****************************************++++++*********************************
************************************+++++...++++++*****************************
*********************************++++++++.. ...+++++***************************
*******************************++++++++++..   ..+++++**************************
******************************++++++++++.     ..++++++*************************
****************************+++++++++....      ..++++++************************
**************************++++++++.......      .....++++***********************
*************************++++++++.   .            ... .++**********************
***********************++++++++...                     ++**********************
*********************+++++++++....                    .+++*********************
******************+++..+++++....                      ..+++********************
**************++++++. ..........                        +++********************
***********++++++++..        ..                         .++********************
*********++++++++++...                                 .++++*******************
********++++++++++..                                   .++++*******************
*******++++++.....                                    ..++++*******************
*******+........                                     ...++++*******************
*******+... ....                                     ...++++*******************
*******+++++......                                    ..++++*******************
*******++++++++++...                                   .++++*******************
*********++++++++++...                                  ++++*******************
**********+++++++++..        ..                        ..++********************
*************++++++.. ..........                        +++********************
******************+++...+++.....                      ..+++********************
*********************+++++++++....                    ..++*********************
***********************++++++++...                     +++*********************
*************************+++++++..   .            ... .++**********************
**************************++++++++.......      ......+++***********************
****************************+++++++++....      ..++++++************************
*****************************++++++++++..     ..++++++*************************
*******************************++++++++++..  ...+++++**************************
*********************************++++++++.. ...+++++***************************
***********************************++++++....+++++*****************************
***************************************++++++++********************************
*******************************************************************************
*******************************************************************************
*******************************************************************************
*******************************************************************************
*******************************************************************************
Evaluated to 0
Ready&gt;
</code></pre><h2 id="conclusion">Conclusion</h2>
<p>Kaleidoscope is a simple, yet complete, language with a good deal of functionality. This serves as
a great language to study the use of Ubiquity.NET.Llvm for code generation and Domain Specific
Languages. While, generally speaking, the functionality of the Ubiquity.NET.Llvm version of this
tutorial differs only slightly from that of the official LLVM version, it serves well as an example
of what you can do with Ubiquity.NET.Llvm.</p>
</article>
          </div>
          <div class="contribution-panel mobile-hide">
              <a href="https://github.com/UbiquityDotNET/Llvm.NET/blob/develop/samples/Kaleidoscope/Kaleidoscope-Overview.md/#L1" title="Improve this Doc" class="fab btn-warning pull-right"><i class="glyphicon glyphicon-pencil"></i></a>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            Copyright (C) 2017-2020, Ubiquity.NET Contributors<br><strong>Build:</strong> 10.0.0
            
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../../styles/main.js"></script>
  </body>
</html>
